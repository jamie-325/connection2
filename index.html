<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame Multi-User Fixed</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2.5.0/dist/socket.io.slim.js"></script>
    <script src="https://unpkg.com/networked-aframe@^0.12.0/dist/networked-aframe.min.js"></script>

    <script>
      // Component to change color and move an object across the network
      AFRAME.registerComponent('interactive-sync', {
        init: function () {
          this.el.addEventListener('click', () => {
            // Take ownership so we are allowed to edit the object
            if (NAF.utils.takeOwnership(this.el)) {
              const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);
              this.el.setAttribute('material', 'color', randomColor);
              
              // Move it slightly
              const pos = this.el.getAttribute('position');
              this.el.setAttribute('position', {x: pos.x, y: pos.y + 0.1, z: pos.z});
            }
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene networked-scene="
      room: fixed-test-room;
      debug: true;
      adapter: wseasyrtc;
      serverURL: https://nafs.dev/;
    ">
      
      <a-assets>
        <template id="avatar-template">
          <a-entity class="avatar">
            <a-sphere class="head" scale="0.3 0.3 0.3" color="#555"></a-sphere>
            <a-box class="eyes" position="0 0 -0.2" scale="0.4 0.1 0.1" color="white"></a-box>
          </a-entity>
        </template>

        <template id="box-template">
          <a-entity geometry="primitive: box" material="color: #4CC3D9"></a-entity>
        </template>
      </a-assets>

      <a-entity id="player" 
                networked="template:#avatar-template;attachTemplateToLocal:false;" 
                camera wasd-controls look-controls position="0 1.6 0">
        <a-cursor fuse="false" raycaster="objects: .clickable"></a-cursor>
      </a-entity>

      <a-entity id="sync-box"
                class="clickable"
                networked="template:#box-template; networkId: shared-box-1;"
                interactive-sync
                position="0 1 -3">
      </a-entity>

      <a-sky color="#ECECEC"></a-sky>
      <a-plane rotation="-90 0 0" width="20" height="20" color="#7BC8A4"></a-plane>

    </a-scene>

    <div id="status" style="position: fixed; top: 10px; left: 10px; padding: 8px; background: rgba(0,0,0,0.5); color: white; font-family: sans-serif; pointer-events: none; z-index: 9999;">
      Connecting...
    </div>

    <script>
      const status = document.getElementById('status');
      document.body.addEventListener('connected', (evt) => {
        status.innerText = 'Connected! Your ID: ' + evt.detail.clientId;
        status.style.background = 'rgba(0,100,0,0.5)';
      });
    </script>
  </body>
</html>
